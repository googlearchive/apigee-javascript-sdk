window.console=window.console||{},window.console.log=window.console.log||function(){};var Usergrid=function(){function e(e){var t=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return e?t.test(e):!1}function t(e){tail=[];var t=[];if(e instanceof Array)for(i in e)t=e[i],t instanceof Array&&t.length>1&&tail.push(t[0]+"="+encodeURIComponent(t[1]));else for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];if(n instanceof Array)for(i in n)t=n[i],tail.push(o+"="+encodeURIComponent(t));else tail.push(o+"="+encodeURIComponent(n))}return tail.join("&")}return window.Usergrid=window.Usergrid||{},Usergrid=Usergrid||{},Usergrid.USERGRID_SDK_VERSION="0.10.06",Usergrid.Client=function(e){this.URI=e.URI||"https://api.usergrid.com",this.orgName=e.orgName,this.appName=e.appName,this.buildCurl=e.buildCurl||!1,this.logging=e.logging||!1,this._callTimeout=e.callTimeout||3e4,this._callTimeoutCallback=e.callTimeoutCallback||null,this.logoutCallback=e.logoutCallback||null},Usergrid.Client.prototype.request=function(e,i){var o=this,n=e.method||"GET",r=e.endpoint,s=e.body||{},a=e.qs||{},l=e.mQuery||!1;if(l)var c=this.URI+"/"+r;else var c=this.URI+"/"+this.orgName+"/"+this.appName+"/"+r;o.getToken()&&(a.access_token=o.getToken());var g=t(a);g&&(c+="?"+g),s=JSON.stringify(s);var u=new XMLHttpRequest;u.open(n,c,!0),s&&(u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Accept","application/json")),u.onerror=function(){o._end=(new Date).getTime(),o.logging&&console.log("success (time: "+o.calcTimeDiff()+"): "+n+" "+c),o.logging&&console.log("Error: API call failed at the network level."),clearTimeout(p);var e=!0;"function"==typeof i&&i(e,data)},u.onload=function(e){if(o._end=(new Date).getTime(),o.logging&&console.log("success (time: "+o.calcTimeDiff()+"): "+n+" "+c),clearTimeout(p),e=JSON.parse(u.responseText),200!=u.status){var t=e.error,r=e.error_description;if(o.logging&&console.log("Error ("+u.status+")("+t+"): "+r),("auth_expired_session_token"==t||"unauthorized"==t||"auth_missing_credentials"==t||"auth_invalid"==t)&&"function"==typeof o.logoutCallback)return o.logoutCallback(!0,e);"function"==typeof i&&i(!0,e)}else"function"==typeof i&&i(!1,e)};var p=setTimeout(function(){u.abort(),"function"===o._callTimeoutCallback?o._callTimeoutCallback("API CALL TIMEOUT"):o.callback("API CALL TIMEOUT")},o._callTimeout);if(this.logging&&console.log("calling: "+n+" "+c),this.buildCurl){var d={uri:c,body:s,method:n};this.buildCurlCall(d)}this._start=(new Date).getTime(),u.send(s)},Usergrid.Client.prototype.createGroup=function(e,t){var i=e.getOnExist||!1,e={path:e.path,client:this,data:e},o=new Usergrid.Group(e);o.fetch(function(e,n){var r=e&&"service_resource_not_found"===n.error||"no_name_specified"===n.error||"null_pointer"===n.error||!e&&i;r?o.save(function(e){"function"==typeof t&&t(e,o)}):"function"==typeof t&&t(e,o)})},Usergrid.Client.prototype.createEntity=function(e,t){var i=e.getOnExist||!1,e={client:this,data:e},o=new Usergrid.Entity(e);o.fetch(function(n,r){var s=n&&"service_resource_not_found"===r.error||"no_name_specified"===r.error||"null_pointer"===r.error||!n&&i;s?(o.set(e.data),o.save(function(e){"function"==typeof t&&t(e,o)})):"function"==typeof t&&t(n,o)})},Usergrid.Client.prototype.restoreEntity=function(e){var t=JSON.parse(e),i={client:this,data:t},o=new Usergrid.Entity(i);return o},Usergrid.Client.prototype.getEntity=function(e,t){var e={client:this,data:e},i=new Usergrid.Entity(e);i.fetch(function(e){"function"==typeof t&&t(e,i)})},Usergrid.Client.prototype.createCollection=function(e,t){e.client=this;var i=new Usergrid.Collection(e,function(e){"function"==typeof t&&t(e,i)})},Usergrid.Client.prototype.restoreCollection=function(e){var t=JSON.parse(e);t.client=this;var i=new Usergrid.Collection(t);return i},Usergrid.Client.prototype.getFeedForUser=function(e,t){var i={method:"GET",endpoint:"users/"+e+"/feed"};this.request(i,function(e,i){"function"==typeof t&&(e?t(e):t(e,i,i.entities))})},Usergrid.Client.prototype.createUserActivity=function(e,t,i){t.type="users/"+e+"/activities";var t={client:this,data:t},o=new Usergrid.Entity(t);o.save(function(e){"function"==typeof i&&i(e,o)})},Usergrid.Client.prototype.createUserActivityWithEntity=function(e,t,i){var o=e.get("username"),n={actor:{displayName:o,uuid:e.get("uuid"),username:o,email:e.get("email"),picture:e.get("picture"),image:{duration:0,height:80,url:e.get("picture"),width:80}},verb:"post",content:t};this.createUserActivity(o,n,i)},Usergrid.Client.prototype.calcTimeDiff=function(){var e=0,t=this._end-this._start;try{e=(t/10/60).toFixed(2)}catch(i){return 0}return e},Usergrid.Client.prototype.setToken=function(e){var t="token"+this.appName+this.orgName;this.token=e,"undefined"!=typeof Storage&&(e?localStorage.setItem(t,e):localStorage.removeItem(t))},Usergrid.Client.prototype.getToken=function(){var e="token"+this.appName+this.orgName;return this.token?this.token:"undefined"!=typeof Storage?localStorage.getItem(e):null},Usergrid.Client.prototype.signup=function(e,t,i,o,n){var r={type:"users",username:e,password:t,email:i,name:o};this.createEntity(r,n)},Usergrid.Client.prototype.login=function(e,t,i){var o=this,n={method:"POST",endpoint:"token",body:{username:e,password:t,grant_type:"password"}};this.request(n,function(e,t){var n={};if(e&&o.logging)console.log("error trying to log user in");else{var r={client:o,data:t.user};n=new Usergrid.Entity(r),o.setToken(t.access_token)}"function"==typeof i&&i(e,t,n)})},Usergrid.Client.prototype.loginFacebook=function(e,t){var i=this,o={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:e}};this.request(o,function(e,o){var n={};if(e&&i.logging)console.log("error trying to log user in");else{var r={client:i,data:o.user};n=new Usergrid.Entity(r),i.setToken(o.access_token)}"function"==typeof t&&t(e,o,n)})},Usergrid.Client.prototype.getLoggedInUser=function(e){if(this.getToken()){var t=this,i={method:"GET",endpoint:"users/me"};this.request(i,function(i,o){if(i)t.logging&&console.log("error trying to log user in"),"function"==typeof e&&e(i,o,null);else{var n={client:t,data:o.entities[0]},r=new Usergrid.Entity(n);"function"==typeof e&&e(i,o,r)}})}else e(!0,null,null)},Usergrid.Client.prototype.isLoggedIn=function(){return this.getToken()?!0:!1},Usergrid.Client.prototype.logout=function(){this.setToken(null)},Usergrid.Client.prototype.buildCurlCall=function(e){var t="curl",i=(e.method||"GET").toUpperCase(),o=e.body||{},n=e.uri;return t+="POST"===i?" -X POST":"PUT"===i?" -X PUT":"DELETE"===i?" -X DELETE":" -X GET",t+=" "+n,'"{}"'!==o&&"GET"!==i&&"DELETE"!==i&&(t+=" -d '"+o+"'"),console.log(t),t},Usergrid.Entity=function(e){e&&(this._client=e.client,this._data=e.data||{})},Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)},Usergrid.Entity.prototype.get=function(e){return e?this._data[e]:this._data},Usergrid.Entity.prototype.set=function(e,t){if("object"==typeof e)for(var i in e)this._data[i]=e[i];else"string"==typeof e?null===t?delete this._data[e]:this._data[e]=t:this._data=null},Usergrid.Entity.prototype.save=function(t){var i=this.get("type"),o="POST";e(this.get("uuid"))&&(o="PUT",i+="/"+this.get("uuid"));var n=this,r={},s=this.get();for(var a in s)"metadata"!==a&&"created"!==a&&"modified"!==a&&"type"!==a&&"activated"!==a&&"uuid"!==a&&(r[a]=s[a]);var l={method:o,endpoint:i,body:r};this._client.request(l,function(e,o){if(e&&n._client.logging){if(console.log("could not save entity"),"function"==typeof t)return t(e,o,n)}else{if(o.entities&&o.entities.length){var r=o.entities[0];n.set(r)}var a="user"===n.get("type")&&s.oldpassword&&s.newpassword;if(a){var l={};l.oldpassword=s.oldpassword,l.newpassword=s.newpassword;var c={method:"PUT",endpoint:i+"/password",body:l};n._client.request(c,function(e,i){e&&n._client.logging&&console.log("could not update user"),n.set("oldpassword",null),n.set("newpassword",null),"function"==typeof t&&t(e,i,n)})}else"function"==typeof t&&t(e,o,n)}})},Usergrid.Entity.prototype.fetch=function(e){var t=this.get("type"),i=this;if(this.get("uuid"))t+="/"+this.get("uuid");else if("users"===t){if(this.get("username"))t+="/"+this.get("username");else if("function"==typeof e){var o="cannot fetch entity, no username specified";return i._client.logging&&console.log(o),e(!0,o,i)}}else if(this.get("name"))t+="/"+encodeURIComponent(this.get("name"));else if("function"==typeof e){var o="cannot fetch entity, no name specified";return i._client.logging&&console.log(o),e(!0,o,i)}var n={method:"GET",endpoint:t};this._client.request(n,function(t,o){if(t&&i._client.logging)console.log("could not get entity");else if(o.user)i.set(o.user);else if(o.entities&&o.entities.length){var n=o.entities[0];i.set(n)}"function"==typeof e&&e(t,o,i)})},Usergrid.Entity.prototype.destroy=function(t){var i=this.get("type");if(e(this.get("uuid")))i+="/"+this.get("uuid");else if("function"==typeof t){var o="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(o),t(!0,o)}var n=this,r={method:"DELETE",endpoint:i};this._client.request(r,function(e,i){e&&n._client.logging?console.log("entity could not be deleted"):n.set(null),"function"==typeof t&&t(e,i)})},Usergrid.Entity.prototype.connect=function(e,t,i){var o=this,n=t.get("type"),r=this.getEntityId(t);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+e+"/"+n+"/"+r,c={method:"POST",endpoint:l};this._client.request(c,function(e,t){e&&o._client.logging&&console.log("entity could not be connected"),"function"==typeof i&&i(e,t)})}else if("function"==typeof i){var g="Error in connect - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}}else if("function"==typeof i){var g="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}},Usergrid.Entity.prototype.getEntityId=function(t){var i=!1;return e(t.get("uuid"))?i=t.get("uuid"):"users"===type?i=t.get("username"):t.get("name")&&(i=t.get("name")),i},Usergrid.Entity.prototype.getConnections=function(e,t){var i=this,o=this.get("type"),n=this.getEntityId(this);if(n){var r=o+"/"+n+"/"+e+"/",s={method:"GET",endpoint:r};this._client.request(s,function(o,n){o&&i._client.logging&&console.log("entity could not be connected"),i[e]={};for(var r=n.entities.length,s=0;r>s;s++)"user"===n.entities[s].type?i[e][n.entities[s].username]=n.entities[s]:i[e][n.entities[s].name]=n.entities[s];"function"==typeof t&&t(o,n,n.entities)})}else if("function"==typeof t){var a="Error in getConnections - no uuid specified.";i._client.logging&&console.log(a),t(!0,a)}},Usergrid.Entity.prototype.disconnect=function(e,t,i){var o=this,n=t.get("type"),r=this.getEntityId(t);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+e+"/"+n+"/"+r,c={method:"DELETE",endpoint:l};this._client.request(c,function(e,t){e&&o._client.logging&&console.log("entity could not be disconnected"),"function"==typeof i&&i(e,t)})}else if("function"==typeof i){var g="Error in connect - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}}else if("function"==typeof i){var g="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}},Usergrid.Collection=function(e,t){if(e&&(this._client=e.client,this._type=e.type,this.qs=e.qs||{},this._list=e.list||[],this._iterator=e.iterator||-1,this._previous=e.previous||[],this._next=e.next||null,this._cursor=e.cursor||null,e.list))for(var i=e.list.length,o=0;i>o;o++){var n=this._client.restoreEntity(e.list[o]);this._list[o]=n}t&&this.fetch(t)},Usergrid.Collection.prototype.serialize=function(){var e={};e.type=this._type,e.qs=this.qs,e.iterator=this._iterator,e.previous=this._previous,e.next=this._next,e.cursor=this._cursor,this.resetEntityPointer();var t=0;for(e.list=[];this.hasNextEntity();){var i=this.getNextEntity();e.list[t]=i.serialize(),t++}return e=JSON.stringify(e)},Usergrid.Collection.prototype.fetch=function(e){var t=this,i=this.qs;this._cursor?i.cursor=this._cursor:delete i.cursor;var o={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(o,function(i,o){if(i&&t._client.logging)console.log("error getting collection");else{var n=o.cursor||null;if(t.saveCursor(n),o.entities){t.resetEntityPointer();var r=o.entities.length;t._list=[];for(var s=0;r>s;s++){var a=o.entities[s].uuid;if(a){var l=o.entities[s]||{},c={type:t._type,client:t._client,uuid:a,data:l},g=new Usergrid.Entity(c),u=t._list.length;t._list[u]=g}}}}"function"==typeof e&&e(i,o)})},Usergrid.Collection.prototype.addEntity=function(e,t){var i=this;e.type=this._type,this._client.createEntity(e,function(e,o){if(!e){var n=i._list.length;i._list[n]=o}"function"==typeof t&&t(e,o)})},Usergrid.Collection.prototype.destroyEntity=function(e,t){var i=this;e.destroy(function(e,o){e?(i._client.logging&&console.log("could not destroy entity"),"function"==typeof t&&t(e,o)):i.fetch(t)})},Usergrid.Collection.prototype.getEntityByUUID=function(e,t){var i={data:{type:this._type,uuid:e},client:this._client},o=new Usergrid.Entity(i);o.fetch(t)},Usergrid.Collection.prototype.getFirstEntity=function(){var e=this._list.length;return e>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var e=this._list.length;return e>0?this._list[e-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var e=this._iterator+1,t=e>=0&&this._list.length>e;return t?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var e=this._iterator>=0&&this._iterator<=this._list.length;return e?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var e=this._iterator-1,t=e>=0&&this._list.length>e;return t?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var e=this._iterator>=0&&this._iterator<=this._list.length;return e?this.list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(e){this._next!==e&&(this._next=e)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(e){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(e))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(e){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(e))},Usergrid.Group=function(e){this._path=e.path,this._list=[],this._client=e.client,this._data=e.data||{},this._data.type="groups"},Usergrid.Group.prototype=new Usergrid.Entity,Usergrid.Group.prototype.fetch=function(e){var t=this,i="groups/"+this._path,o="groups/"+this._path+"/users",n={method:"GET",endpoint:i},r={method:"GET",endpoint:o};this._client.request(n,function(i,o){if(i)t._client.logging&&console.log("error getting group"),"function"==typeof e&&e(i,o);else if(o.entities){var n=o.entities[0];t._data=n||{},t._client.request(r,function(i,o){if(i&&t._client.logging)console.log("error getting group users");else if(o.entities){var n=o.entities.length;t._list=[];for(var r=0;n>r;r++){var s=o.entities[r].uuid;if(s){var a=o.entities[r]||{},l={type:a.type,client:t._client,uuid:s,data:a},c=new Usergrid.Entity(l);t._list.push(c)}}}"function"==typeof e&&e(i,o,t._list)})}})},Usergrid.Group.prototype.members=function(e){"function"==typeof e&&e(null,this._list)},Usergrid.Group.prototype.add=function(e,t){var i=this,e={method:"POST",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,o){e?"function"==typeof t&&t(e,o,o.entities):i.fetch(t)})},Usergrid.Group.prototype.remove=function(e,t){var i=this,e={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,o){e?"function"==typeof t&&t(e,o):i.fetch(t)})},Usergrid.Group.prototype.feed=function(e){var t=this,i="groups/"+this._path+"/feed",o={method:"GET",endpoint:i};this._client.request(o,function(i,o){i&&t.logging&&console.log("error trying to log user in"),"function"==typeof e&&e(i,o,o.entities)})},Usergrid.Group.prototype.createGroupActivity=function(e,t){var i=e.user,e={actor:{displayName:i.get("username"),uuid:i.get("uuid"),username:i.get("username"),email:i.get("email"),picture:i.get("picture"),image:{duration:0,height:80,url:i.get("picture"),width:80}},verb:"post",content:e.content};e.type="groups/"+this._path+"/activities";var e={client:this._client,data:e},o=new Usergrid.Entity(e);o.save(function(e){"function"==typeof t&&t(e,o)})},Usergrid}(),Apigee=function(){function e(e){var t=e||{},o={logLevel:l.assert,logMessage:t.logMessage,tag:t.tag,timeStamp:i()};u.push(o)}function t(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function i(){return""+(new Date).getTime()}function o(){if(null===typeof window.localStorage.getItem("uuid"))return window.localStorage.getItem("uuid");var e=t();return window.localStorage.setItem("uuid",e),window.localStorage.getItem("uuid")}function n(){return window.device!==void 0}function r(){return window.forge!==void 0}function s(){return"undefined"!=typeof Titanium}var a={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},l={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},c={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},g="UNKNOWN",u=[],p=[],d=Usergrid;return d.MobileAnalytics=function(e){if(this.orgName=e.orgName,this.appName=e.appName,this.syncOnClose=e.syncOnClose||!1,this.testMode=e.testMode||!1,this.apiUrl=e.apiUrl===void 0?"https://api.usergrid.org/":e.apiUrl,this.syncDate=i(),e.config!==void 0?(this.configuration=e.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig):this.downloadConfig(),null!==this.configuration){var t=0;if(100>this.deviceConfig.samplingRate&&(t=Math.floor(101*Math.random())),this.deviceConfig.samplingRate>t){this.appId=this.configuration.instaOpsApplicationId,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var o=3e3;this.deviceConfig.agentUploadIntervalInSeconds!==void 0&&(o=1e3*this.deviceConfig.agentUploadIntervalInSeconds);var a=this;this.syncOnClose?n()?window.addEventListener("pause",function(){a.prepareSync()},!1):r()?forge.event.appPaused.addListener(function(){},function(e){console.log("Error syncing data."),console.log(e)}):s()||window.addEventListener("beforeunload",function(){a.prepareSync()}):setInterval(function(){a.prepareSync()},o),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=d.MobileAnalytics.catchCrashReport}}else console.log("Error configuration unavailable.")},d.MobileAnalytics.prototype.downloadConfig=function(e){var t=new XMLHttpRequest,i=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";if("function"==typeof e)t.open(a.get,i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=onreadystatechange,t.send();else if(t.open(a.get,i,!1),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send(),200===t.status){var o=JSON.parse(t.responseText);this.configuration=o,this.deviceConfig=o.deviceLevelOverrideEnabled===!0?o.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?o.abtestingAppConfig:o.defaultAppConfig}else this.configuration=null},d.MobileAnalytics.prototype.sync=function(e){var t={};t.logs=e.logs,t.metrics=e.metrics,t.sessionMetrics=this.sessionMetrics,t.orgName=this.orgName,t.appName=this.appName,t.fullAppName=this.orgName+"_"+this.appName,t.instaOpsApplicationId=this.configuration.instaOpsApplicationId,t.timeStamp=i();var o=new XMLHttpRequest,n=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(o.open(a.post,n,!1),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t)),200===o.status){u=[],p=[];var r=o.responseText;console.log(r)}else console.log("Error syncing"),console.log(o.responseText)},d.MobileAnalytics.catchCrashReport=function(t,i,o){e({tag:"CRASH",logMessage:"Error:"+t+" for url:"+i+" on line:"+o})},d.MobileAnalytics.prototype.startSession=function(){var e=this,a={};if(a.timeStamp=i(),a.networkCarrier=g,a.deviceCountry=g,a.batteryLevel="-100",a.networkSubType=g,a.networkCountry=g,a.sessionId=t(),a.applicationVersion="1.0",a.appId=""+this.appId,this.deviceConfig.locationCaptureEnabled&&navigator.geolocation!==void 0&&navigator.geolocation.getCurrentPosition(function(t){e.sessionMetrics.latitude=t.coords.latitude,e.sessionMetrics.longitude=t.coords.longitude}),n())a.devicePlatform=window.device.platform,a.deviceOSVersion=window.device.version,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?this.deviceConfig.obfuscateDeviceId?o():window.device.uuid:this.deviceConfig.obfuscateDeviceId?o():g,a.deviceModel=window.device.name,a.networkType=navigator.connection.type;else if(r()){var l=g;forge.is.ios()?l="iOS":forge.is.android()&&(l="Android"),a.devicePlatform=g,a.deviceOSVersion=l,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?o():g,a.deviceModel=g,a.networkType=forge.is.connection.wifi()?"WIFI":g}else if(s()){var e=this;Ti.App.addEventListener("analytics:platformMetrics",function(t){e.sessionMetrics.devicePlatform=t.name,e.sessionMetrics.deviceOSVersion=t.osname,e.sessionMetrics.deviceId=e.deviceConfig.deviceIdCaptureEnabled?e.deviceConfig.obfuscateDeviceId?o():t.uuid:e.deviceConfig.obfuscateDeviceId?o():g,e.sessionMetrics.deviceModel=t.model,e.sessionMetrics.networkType=t.networkType})}else{if(window.localStorage!==void 0&&(a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?o():g),navigator.userAgent!==void 0){var c,u,p,d=navigator.userAgent,f=navigator.appName;-1!=(u=d.indexOf("Opera"))?(f="Opera",fullVersion=d.substring(u+6),-1!=(u=d.indexOf("Version"))&&(fullVersion=d.substring(u+8))):-1!=(u=d.indexOf("MSIE"))?(f="Microsoft Internet Explorer",fullVersion=d.substring(u+5)):-1!=(u=d.indexOf("Chrome"))?(f="Chrome",fullVersion=d.substring(u+7)):-1!=(u=d.indexOf("Safari"))?(f="Safari",fullVersion=d.substring(u+7),-1!=(u=d.indexOf("Version"))&&(fullVersion=d.substring(u+8))):-1!=(u=d.indexOf("Firefox"))?(f="Firefox",fullVersion=d.substring(u+8)):(c=d.lastIndexOf(" ")+1)<(u=d.lastIndexOf("/"))&&(f=d.substring(c,u),fullVersion=d.substring(u+1),f.toLowerCase()==f.toUpperCase()&&(f=navigator.appName)),-1!=(p=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,p)),-1!=(p=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,p)),a.devicePlatform=f,a.deviceOSVersion=fullVersion}else a.devicePlatform=g,a.deviceOSVersion=g;navigator.language!==void 0&&(a.localLanguage=navigator.language)}this.sessionMetrics=a,s()&&Ti.App.fireEvent("analytics:attachReady")},d.MobileAnalytics.prototype.patchNetworkCalls=function(e){"use strict";var t=this,o=e.prototype.open,n=e.prototype.send;e.prototype.open=function(e,t,i,n,r){this._method=e,this._url=t,o.call(this,e,t,i,n,r)},e.prototype.send=function(e){function o(){if(4==a.readyState&&-1===l.indexOf("/!gap_exec")&&-1===l.indexOf(t.apiUrl)){var e=i(),o=e-r,n={url:l,startTime:""+r,endTime:""+e,numSamples:"1",latency:""+o,timeStamp:""+r,httpStatusCode:""+a.status,responseDataSize:""+a.responseText.length};200==a.status?(n.numErrors="0",console.log(JSON.stringify(n)),t.logNetworkCall(n)):(n.numErrors="1",t.logNetworkCall(n))}s&&s()}var r,s,a=this;this._method;var l=this._url;this.noIntercept||(r=i(),this.addEventListener?this.addEventListener("readystatechange",o,!1):(s=this.onreadystatechange,this.onreadystatechange=o)),n.call(this,e)}},d.MobileAnalytics.prototype.patchLoggingCalls=function(){var e=this,t=window.console;if(window.console={log:function(){e.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),t.log.apply(t,arguments)},warn:function(){e.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),t.warn.apply(t,arguments)},error:function(){e.logError({tag:"CONSOLE",logMessage:arguments[0]}),t.error.apply(t,arguments)},assert:function(){e.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),t.assert.apply(t,arguments)},debug:function(){e.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),t.debug.apply(t,arguments)}},s()){var i=Ti.API;window.console.log=function(){i.info.apply(i,arguments)},Ti.API={info:function(){e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]}),i.info.apply(i,arguments)},log:function(){var t=arguments[0];"info"===t?e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"warn"===t?e.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"error"===t?e.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"debug"===t?e.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"trace"===t?e.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}),i.log.apply(i,arguments)}}}},d.MobileAnalytics.prototype.prepareSync=function(){var e={},t=this;t.sessionMetrics!==void 0&&(e.sessionMetrics=t.sessionMetrics);var o=!1;this.syncDate=i(),p.length>0&&(o=!0),u.length>0&&(o=!0),e.logs=u,e.metrics=p,o&&!t.testMode&&this.sync(e)},d.MobileAnalytics.prototype.logMessage=function(e){var t=e||{},o={logLevel:t.logLevel,logMessage:t.logMessage.substring(0,250),tag:t.tag,timeStamp:i()};u.push(o)},d.MobileAnalytics.prototype.logVerbose=function(e){var t=e||{};t.logLevel=l.verbose,this.deviceConfig.logLevelToMonitor>=c.verbose&&this.logMessage(e)},d.MobileAnalytics.prototype.logDebug=function(e){var t=e||{};t.logLevel=l.debug,this.deviceConfig.logLevelToMonitor>=c.debug&&this.logMessage(e)},d.MobileAnalytics.prototype.logInfo=function(e){var t=e||{};t.logLevel=l.info,this.deviceConfig.logLevelToMonitor>=c.info&&this.logMessage(e)},d.MobileAnalytics.prototype.logWarn=function(e){var t=e||{};t.logLevel=l.warn,this.deviceConfig.logLevelToMonitor>=c.warn&&this.logMessage(e)},d.MobileAnalytics.prototype.logError=function(e){var t=e||{};t.logLevel=l.error,this.deviceConfig.logLevelToMonitor>=c.error&&this.logMessage(e)},d.MobileAnalytics.prototype.logAssert=function(e){var t=e||{};t.logLevel=l.assert,this.deviceConfig.logLevelToMonitor>=c.assert&&this.logMessage(e)},d.MobileAnalytics.prototype.logNetworkCall=function(e){p.push(e)},d.MobileAnalytics.prototype.getConfig=function(){},d.MobileAnalytics.prototype.logs=function(){return u},d.MobileAnalytics.prototype.metrics=function(){return p},d.MobileAnalytics.prototype.sessionMetrics=function(){return this.sessionMetrics},d.MobileAnalytics.prototype.clearMetrics=function(){u=[],p=[]},d}();